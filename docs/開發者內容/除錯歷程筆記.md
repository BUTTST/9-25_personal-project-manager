# 專案除錯歷程筆記

本文檔記錄了專案開發過程中遇到的所有錯誤問題、解決方案及改進建議。

## 📊 總覽統計

- **總錯誤數量**: 9 個
- **部署問題**: 1 個 (11.1%)
- **代碼問題**: 8 個 (88.9%)
- **涉及檔案**: 9 個
- **解決狀態**: 全部已修復 ✅

---

## 🚀 部署問題

### 1. Canvas 依賴安裝失敗
**📍 問題檔案**: `package.json`, Vercel 建置環境
**⏰ 發生時間**: 首次部署嘗試
**🔴 錯誤等級**: 高 (阻擋部署)

**核心錯誤資訊**:
```
npm error Package pixman-1 was not found in the pkg-config search path.
npm error Package 'pixman-1', required by 'virtual:world', not found
```

**🔧 改善方式**:
- 分析問題：`canvas` 套件在 Vercel 建置環境缺少系統依賴
- 移除未使用的 `canvas` 依賴（實際使用 `sharp` 處理圖標）
- 更新部署指南，新增 canvas 依賴問題的故障排除說明

**✅ 結果**: 建置成功通過，移除 1 個不必要的依賴
**📝 說明**: canvas 套件需要原生編譯，在無 GPU 的建置環境中容易失敗

---

## 💻 代碼問題

### 2. Heroicons ExternalLinkIcon 不存在
**📍 問題檔案**: `app/components/admin/ProjectTable.tsx`
**⏰ 發生時間**: 部署測試階段
**🟡 錯誤等級**: 中 (TypeScript 編譯錯誤)

**核心錯誤資訊**:
```
Type error: Module '"@heroicons/react/24/outline"' has no exported member 'ExternalLinkIcon'.
```

**🔧 改善方式**:
- 檢查程式碼使用情況，發現 `ExternalLinkIcon` 未實際使用
- 從匯入語句中移除該 icon
- 保留 `CodeBracketIcon` 和 `GlobeAltIcon` 用於 GitHub 和 Vercel 連結

**✅ 結果**: 編譯通過，清理未使用代碼
**📝 說明**: Heroicons 版本更新可能移除某些 icon，應檢查官方文檔確認可用性

### 3. Next.js 配置過時警告
**📍 問題檔案**: `next.config.js`
**⏰ 發生時間**: 建置過程中
**🟢 錯誤等級**: 低 (僅警告，不阻擋建置)

**核心錯誤資訊**:
```
⚠ Invalid next.config.js options detected:
⚠     Unrecognized key(s) in object: 'appDir' at "experimental"
```

**🔧 改善方式**:
- 移除過時的 `experimental.appDir` 配置
- Next.js 14 中 App Router 已是預設功能

**✅ 結果**: 消除配置警告，代碼更簡潔
**📝 說明**: Next.js 版本更新後應檢查配置選項的兼容性

### 4. API 路由缺少驗證函數
**📍 問題檔案**: `app/api/projects/reorder/route.ts`
**⏰ 發生時間**: 新增拖拽排序功能後
**🔴 錯誤等級**: 高 (編譯錯誤)

**核心錯誤資訊**:
```
Type error: Module '"@/lib/auth"' has no exported member 'isAdminRequest'.
```

**🔧 改善方式**:
- 檢查現有 API 路由的驗證模式
- 使用統一的密碼標頭驗證方式替換不存在的 `isAdminRequest` 函數
- 確保所有 API 路由使用一致的驗證邏輯

**✅ 結果**: 新增的排序 API 正常工作
**📝 說明**: 新增功能時應遵循現有代碼的模式和約定

### 5. Tailwind CSS 顏色變體缺失
**📍 問題檔案**: `app/globals.css`, `tailwind.config.js`
**⏰ 發生時間**: CSS 編譯階段
**🔴 錯誤等級**: 高 (建置失敗)

**核心錯誤資訊**:
```
The `dark:hover:bg-primary-400` class does not exist.
The `hover:border-primary-200` class does not exist.
```

**🔧 改善方式**:
- 檢查 `tailwind.config.js` 中的 primary 顏色定義
- 將不存在的 `primary-400` 改為 `primary-600`
- 將不存在的 `primary-200` 改為 `primary-500/20`
- 更新部署指南記錄此問題

**✅ 結果**: CSS 編譯通過，自定義樣式正常工作
**📝 說明**: 使用 Tailwind 自定義顏色時應確認所有變體都已定義

### 6. Project 類型缺少 sortOrder 屬性
**📍 問題檔案**: `app/types/index.ts`, 多個元件檔案
**⏰ 發生時間**: 新增排序功能後
**🔴 錯誤等級**: 高 (多處編譯錯誤)

**核心錯誤資訊**:
```
Property 'sortOrder' is missing in type '{...}' but required in type 'Project'.
```

**🔧 改善方式**:
- 在 `Project` 介面中添加 `sortOrder: number` 屬性
- 在 `TableImportSection.tsx` 中為匯入專案設置預設排序值
- 在 `sample-data.ts` 中為所有範例專案添加排序值
- 在 `app/api/projects/route.ts` 中實現排序邏輯

**✅ 結果**: 排序功能正常運作，類型檢查通過
**📝 說明**: 修改介面定義時應同步更新所有相關的數據創建邏輯

### 7. TableImportSection 元件 TypeScript 錯誤
**📍 問題檔案**: `app/components/admin/TableImportSection.tsx`
**⏰ 發生時間**: 建置檢查階段
**🟡 錯誤等級**: 中 (85 個 linting 錯誤)

**核心錯誤資訊**:
```
參數 'proj' 隱含了 'any' 類型
找不到模組 'react' 或其對應的型別宣告
JSX 項目隱含了類型 'any'
```

**🔧 改善方式**:
- 添加完整的 React 匯入語句
- 為所有函數參數添加明確的類型註解
- 修復事件處理器的類型
- 更新 TypeScript 配置以支援現代語法
- 處理舊版 TypeScript 的 `trimEnd` 兼容性問題

**✅ 結果**: 僅剩 2 個模組解析警告（不影響編譯）
**📝 說明**: 大型元件的類型檢查應及早進行，避免累積錯誤

### 8. ProjectVisibility 類型缺失
**📍 問題檔案**: `app/types/index.ts`, `app/components/project/ProjectCard.tsx`
**⏰ 發生時間**: 最終建置檢查
**🟡 錯誤等級**: 中 (TypeScript 編譯錯誤)

**核心錯誤資訊**:
```
Module '"@/types"' has no exported member 'ProjectVisibility'.
```

**🔧 改善方式**:
- 在 `types/index.ts` 中添加 `ProjectVisibility` 類型定義
- 使用 `Project['visibility']` 作為類型來源
- 確保類型定義與實際使用保持同步

**✅ 結果**: 專案卡片的可見性控制功能正常運作
**📝 說明**: 共用的類型應集中定義，避免重複定義

### 9. AdminPage JSX 語法錯誤
**📍 問題檔案**: `app/admin/page.tsx`
**⏰ 發生時間**: 最終部署檢查
**🟡 錯誤等級**: 中 (TypeScript 編譯錯誤)

**核心錯誤資訊**:
```
Type error: Unexpected token. Did you mean `{'}'}` or `&rbrace;`?
```

**🔧 改善方式**:
- 檢查 JSX 標籤的閉合結構
- 發現 `)}` 語法錯誤，應為 `</div>`
- 移除多餘的 `</div>` 標籤，確保標籤正確匹配
- 驗證整個元件的括號和標籤匹配

**✅ 結果**: JSX 語法錯誤修復，編譯通過
**📝 說明**: JSX 語法錯誤通常由標籤或括號不匹配引起，應仔細檢查標籤結構

---

## 📈 改進建議

### 🔧 開發流程改進
1. **早期類型檢查**: 在開發新功能時應立即進行 TypeScript 編譯檢查
2. **統一驗證模式**: 建立統一的 API 驗證模式，避免重複實現
3. **依賴管理**: 定期檢查並移除未使用的依賴套件

### 🚀 部署優化
1. **建置測試**: 在本機完成全面測試後再推送至生產環境
2. **錯誤監控**: 設定建置失敗通知，及早發現問題
3. **快取策略**: 利用 Vercel 的建置快取提升部署速度

### 📚 文檔維護
1. **部署指南**: 記錄常見部署問題及解決方案
2. **代碼規範**: 建立 TypeScript 和 CSS 使用規範
3. **錯誤參考**: 維護此類除錯歷程，加速問題解決

---

## 🎯 總結

通過此次除錯過程，我們成功解決了所有阻擋部署的關鍵問題，專案現在能夠穩定部署到 Vercel。代碼品質得到顯著提升，類型安全性更強，開發體驗更好。

**關鍵學習點**:
- 部署問題通常與環境依賴相關，應優先檢查
- TypeScript 錯誤應及早修復，避免問題累積
- 介面變更時需同步更新所有相關代碼
- 保持依賴和配置的整潔是長期維護的關鍵

---

*最後更新: 2025年9月26日 (第9個錯誤修復)*
*專案版本: 9-25 個人專案管理平台*
