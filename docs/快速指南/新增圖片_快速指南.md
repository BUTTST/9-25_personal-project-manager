# 📸 新增專案圖片 - 快速指南（Supabase Storage 版）

## ⚡ 10 秒速覽流程圖

```
┌──────────────┐
│ 1. 登入後台  │  ─→  進入管理後台 → 圖片管理
└──────────────┘
        ↓
┌──────────────┐
│ 2. 上傳圖片  │  ─→  選擇圖片 → 點擊上傳
└──────────────┘
        ↓
┌──────────────┐
│ 3. 完成！    │  ─→  圖片立即可在「編輯專案」中選擇
└──────────────┘
```

**就這麼簡單！** 完全通過 Web 界面操作，無需任何技術操作。

---

## 📝 詳細步驟（3 步驟）

### **步驟 1：進入圖片管理**

1. 訪問你的專案管理平台
2. 點擊「管理後台」按鈕（需要管理員密碼）
3. 進入後，點擊「圖片管理」標籤

```
首頁 → [管理後台] → 圖片管理
```

---

### **步驟 2：上傳圖片**

1. 在「圖片管理」頁面，點擊「選擇圖片」或直接拖拽圖片
2. **支援批量上傳**：可一次選擇多張圖片
3. 點擊「上傳」按鈕

**支援格式**：`.png`, `.jpg`, `.jpeg`, `.webp`, `.gif`

**中文檔名支援**：
- ✅ **完全支援中文檔名**！例如：`專案截圖(主界面).png`
- ✅ 前端會完整顯示中文檔名
- ✅ 後端自動處理存儲兼容性

**檔名建議**：
```
✅ 推薦：
  - 10-16_SME-accounting-inventory-system(設定).png
  - Whisper 語音轉譯服務(總結).png
  - 臉書貼文排版格式化工具.png
  - 專案管理平台(主界面).png

✅ 可用：
  - screenshot-2025-10-29.png
  - dashboard-view.png

⚠️ 避免：
  - test.png (過於簡短)
  - 圖片.png (太通用)
```

> 💡 **重要**：檔名將作為圖片標題顯示，請使用描述性名稱！

---

### **步驟 3：使用圖片**

上傳完成後，圖片會**立即**出現在「編輯專案」頁面的圖片選擇器中。

#### **在新增專案時使用**
1. 管理後台 → 「新增專案」
2. 滾動到「圖片預覽」區塊
3. 勾選要顯示的圖片（可多選）
4. 選擇顯示模式：
   - **單張切換**：訪客可點擊/按鈕切換查看
   - **多張並列**：同時展開所有圖片
5. 儲存專案

#### **在編輯現有專案時使用**
1. 管理後台 → 點擊專案的「編輯」按鈕
2. 找到「圖片預覽」區塊
3. 勾選/取消圖片
4. 儲存

---

## 🎨 中文檔名完整支援

### ✨ 核心特性

我們的系統**完全支援中文檔名**，採用智能雙檔名策略：

```
用戶上傳：10-16_SME(設定).png
    ↓
後端存儲：10-16_SME-()-a3f9c2.png  (ASCII 安全格式)
    ↓
前端顯示：10-16_SME(設定)  (完整中文檔名)
```

**優點**：
- ✅ 用戶看到的是原始中文檔名
- ✅ 後端存儲符合技術規範
- ✅ 防止檔名衝突（智能 hash 識別）
- ✅ 防止重複上傳（相同檔名會提示）

### 📋 檔名範例

| 上傳的檔名 | 前端顯示 | 說明 |
|-----------|---------|------|
| `10-16_SME(設定).png` | `10-16_SME(設定)` | ✅ 完整保留中文 |
| `報表截圖.png` | `報表截圖` | ✅ 純中文也可以 |
| `Screenshot(主界面).png` | `Screenshot(主界面)` | ✅ 中英混合 |
| `5-25 現金工具(上).png` | `5-25 現金工具(上)` | ✅ 包含空格 |

---

## 🔒 重複上傳防護

系統會智能檢測重複圖片：

### **案例 1：相同檔名**
```
第一次上傳：專案截圖.png  ✅ 成功
第二次上傳：專案截圖.png  ❌ 錯誤：「圖片「專案截圖.png」已存在於系統中」
```

### **案例 2：不同中文但清理後相同**
```
第一次上傳：10-16_SME(設定).png   ✅ 成功
第二次上傳：10-16_SME(報表).png   ✅ 成功（不同圖片，成功區分）
```

**智能識別**：
- 系統使用 **hash 識別**技術
- 即使兩個檔名清理後看起來相同，也能正確區分
- 真正相同的檔名會被阻止（避免浪費空間）

---

## 🗑️ 刪除圖片

### **步驟 1：進入圖片管理**
1. 管理後台 → 圖片管理
2. 找到要刪除的圖片

### **步驟 2：檢查引用**
系統會自動檢查哪些專案正在使用此圖片：
- 如果有專案引用，會顯示警告
- 可以選擇強制刪除或取消

### **步驟 3：確認刪除**
點擊刪除按鈕，確認後圖片會：
- 從 Supabase Storage 中移除
- 使用該圖片的專案會顯示「圖片已移除」

> ⚠️ **注意**：刪除操作**不可恢復**！

---

## 🔍 圖片管理功能

### **查看所有圖片**
- 網格視圖顯示所有上傳的圖片
- 顯示原始中文檔名
- 顯示上傳時間和大小
- 支援搜索和篩選（開發中）

### **批量操作**（開發中）
- 批量上傳
- 批量刪除
- 批量重命名

---

## ⚠️ 常見問題與解決

### ❌ **問題 1：上傳失敗「The resource already exists」**

**原因**：相同檔名的圖片已存在

**解決方法**：
1. 檢查是否已經上傳過相同檔名的圖片
2. 如果是不同圖片，請重新命名後再上傳
3. 如果是相同圖片，無需重複上傳，直接使用即可

---

### ❌ **問題 2：上傳後圖片不顯示**

**可能原因**：
1. 瀏覽器緩存問題
2. 網絡連接問題

**解決方法**：
1. 重新整理頁面（F5）
2. 清除瀏覽器緩存
3. 檢查網絡連接
4. 聯繫管理員查看 Supabase Storage 狀態

---

### ❌ **問題 3：圖片格式不支援**

**支援格式**：
- ✅ PNG (.png)
- ✅ JPEG (.jpg, .jpeg)
- ✅ WebP (.webp)
- ✅ GIF (.gif)
- ❌ SVG (.svg) - 暫不支援
- ❌ PDF (.pdf) - 不支援

**解決方法**：
使用圖片編輯軟體轉換為支援的格式

---

### ❌ **問題 4：中文檔名顯示亂碼**

**這不應該發生！** 我們的系統完全支援中文。

**如果出現此問題**：
1. 檢查瀏覽器編碼設定（應為 UTF-8）
2. 重新整理頁面
3. 聯繫技術支援

---

## 💡 最佳實踐

### **檔名規範**

#### ✅ 推薦做法
```
描述性 + 功能說明：
  - 10-16_SME會計系統(商品-存貨_明亮).png
  - Whisper 語音轉譯服務(總結).png
  - 專案管理平台-主界面.png

日期前綴（可選）：
  - 2025-10-29-新功能截圖.png
  - 10-15-youtube-工具.png
```

#### ⚠️ 避免做法
```
過於簡短：
  - img1.png
  - test.png
  - 圖.png

特殊字符（部分不支援）：
  - 檔案?.png
  - my:image.png
  - file*name.png
```

### **組織建議**

1. **使用括號區分**：`專案名稱(主界面).png`、`專案名稱(設定頁).png`
2. **加入日期**：方便追蹤版本
3. **描述性名稱**：讓其他人也能理解

### **批量上傳技巧**

- 一次最多上傳 20 張圖片（建議）
- 統一命名規則，方便管理
- 上傳前檢查檔名，確保描述性

---

## 🎯 與舊版（硬編碼）對比

| 功能 | 舊版（public/前端截圖/） | 新版（Supabase Storage） |
|------|----------------------|----------------------|
| 上傳方式 | Git 推送 | Web 界面上傳 |
| 技術要求 | 需要 Git 知識 | 完全不需要 |
| 中文檔名 | 部分支援 | **完全支援** |
| 即時可用 | 需等待部署 (1-2分鐘) | **立即可用** |
| 刪除圖片 | Git 操作 | 點擊刪除按鈕 |
| 管理便利性 | ⭐⭐ | **⭐⭐⭐⭐⭐** |
| 重複檢測 | ❌ 無 | **✅ 智能檢測** |

**結論**：新版更簡單、更強大、更友好！ ✨

---

## 🔐 安全性說明

### ✅ **完全安全**

| 項目 | 說明 |
|------|------|
| 🔐 權限控制 | 需要管理員密碼才能上傳 |
| 🗄️ 安全存儲 | 使用 Supabase Storage（企業級安全） |
| 🚫 防止濫用 | 檔名 hash 識別，防止重複 |
| 📝 操作記錄 | 所有上傳都有時間戳記錄 |
| 🔒 數據隔離 | 每個專案獨立的 Storage bucket |

---

## 🚀 技術架構（給開發者）

### 完整流程圖

```
用戶上傳（Web）
    ↓
[10-16_SME(設定).png]
    ↓
前端 ImageUploader
    ↓
POST /api/images
    ↓
uploadImage() 處理
├─ 生成 hash: a3f9c2
├─ 清理檔名: 10-16_SME-().png
├─ 組合: 10-16_SME-()-a3f9c2.png
├─ 檢查重複（hash）
└─ 存儲到 Supabase
    ├─ 檔案: 10-16_SME-()-a3f9c2.png
    └─ Metadata: originalFilename = "10-16_SME(設定).png"
    ↓
Supabase Storage
    ↓
GET /api/images
    ↓
listImages() 讀取
├─ 讀取檔案列表
├─ 從 metadata 提取 originalFilename
└─ 返回前端
    ↓
前端顯示
└─ 標題：10-16_SME(設定)  ✅
```

### 相關技術文件
- `app/lib/storage.ts` - Storage 操作邏輯
- `app/api/images/route.ts` - 圖片 API
- `app/components/admin/ImageUploader.tsx` - 上傳組件
- `更換資料庫 Vercel Blob - Supabase/中文檔名問題-增加Hash識別重檔.md` - 詳細技術文檔

---

**最後更新**：2025-10-29  
**版本**：Supabase Storage 版（v3.0）  
**狀態**：✅ 生產就緒

**變更歷史**：
- 2025-10-29：完全改版為 Supabase Storage，支援中文檔名
- 2025-10-22：舊版（硬編碼 public/前端截圖/）
