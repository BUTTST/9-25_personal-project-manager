# éšæ®µ 3ï¼šç¨‹å¼ç¢¼æ”¹é€ æŒ‡å—

> â±ï¸ é ä¼°æ™‚é–“ï¼š1.5-2 å°æ™‚  
> ğŸ¯ ç›®æ¨™ï¼šä¿®æ”¹ç¨‹å¼ç¢¼ä»¥é€£æ¥ Supabase è³‡æ–™åº«  
> ğŸ“ é›£åº¦ï¼šâ­â­â­â­

---

## ğŸ“‹ æœ¬éšæ®µç›®æ¨™

å®Œæˆå¾Œï¼Œæ‚¨å°‡é”æˆï¼š
- âœ… å®‰è£ Supabase å®¢æˆ¶ç«¯å¥—ä»¶
- âœ… å»ºç«‹è³‡æ–™å­˜å–å±¤ (`app/lib/supabase.ts`)
- âœ… ä¿®æ”¹ 7 å€‹ API è·¯ç”±æª”æ¡ˆ
- âœ… æ›´æ–°ç’°å¢ƒè®Šæ•¸é…ç½®
- âœ… æœ¬åœ°æ¸¬è©¦æ‰€æœ‰åŠŸèƒ½æ­£å¸¸

---

## ğŸ“¦ æ­¥é©Ÿ 1ï¼šå®‰è£ä¾è³´å¥—ä»¶

### 1.1 å®‰è£ Supabase å®¢æˆ¶ç«¯

```bash
# åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„åŸ·è¡Œ
npm install @supabase/supabase-js

# å¦‚æœä½¿ç”¨ yarn
yarn add @supabase/supabase-js

# å¦‚æœä½¿ç”¨ pnpm
pnpm add @supabase/supabase-js
```

**ç­‰å¾…å®‰è£å®Œæˆ**ï¼ˆç´„ 10-30 ç§’ï¼‰

### 1.2 é©—è­‰å®‰è£

```bash
# æª¢æŸ¥ package.json
cat package.json | grep supabase

# æ‡‰è©²çœ‹åˆ°ï¼š
# "@supabase/supabase-js": "^2.x.x"
```

---

## ğŸ”§ æ­¥é©Ÿ 2ï¼šå»ºç«‹ Supabase å®¢æˆ¶ç«¯

### 2.1 å»ºç«‹æ–°æª”æ¡ˆ

**æª”æ¡ˆè·¯å¾‘**ï¼š`app/lib/supabase.ts`

**å®Œæ•´å…§å®¹**ï¼š

```typescript
import { createClient } from '@supabase/supabase-js';
import type {
  ProjectData,
  Project,
  PasswordEntry,
  AppSettings,
  UIDisplaySettings,
} from '@/types';

// =====================================================
// Supabase å®¢æˆ¶ç«¯åˆå§‹åŒ–
// =====================================================

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;

// å‰ç«¯ä½¿ç”¨ï¼ˆå…¬é–‹é‡‘é‘°ï¼‰
export const supabase = createClient(supabaseUrl, supabaseAnonKey);

// å¾Œç«¯ä½¿ç”¨ï¼ˆæœå‹™é‡‘é‘°ï¼Œç¹é RLSï¼‰
export const supabaseAdmin = createClient(supabaseUrl, supabaseServiceKey);

// =====================================================
// è³‡æ–™è®€å–å‡½æ•¸
// =====================================================

/**
 * è®€å–æ‰€æœ‰å°ˆæ¡ˆè³‡æ–™ï¼ˆç®¡ç†å“¡æ¨¡å¼ï¼‰
 */
export async function readProjectData(): Promise<ProjectData> {
  try {
    // 1. è®€å–å°ˆæ¡ˆ
    const { data: projects, error: projectsError } = await supabaseAdmin
      .from('projects')
      .select('*')
      .order('sort_order', { ascending: true });

    if (projectsError) throw projectsError;

    // 2. è®€å–å¯†ç¢¼
    const { data: passwords, error: passwordsError } = await supabaseAdmin
      .from('passwords')
      .select('*');

    if (passwordsError) throw passwordsError;

    // 3. è®€å–è¨­å®š
    const { data: settingsData, error: settingsError } = await supabaseAdmin
      .from('settings')
      .select('*');

    if (settingsError) throw settingsError;

    // 4. çµ„åˆè¨­å®šè³‡æ–™
    const appSettingsRow = settingsData.find(s => s.key === 'app_settings');
    const uiDisplayRow = settingsData.find(s => s.key === 'ui_display');

    const settings: AppSettings = {
      ...(appSettingsRow?.value as any),
      uiDisplay: uiDisplayRow?.value as UIDisplaySettings,
    };

    // 5. è½‰æ›å°ˆæ¡ˆè³‡æ–™æ ¼å¼ï¼ˆè³‡æ–™åº«æ¬„ä½åç¨± â†’ ç¨‹å¼ç¢¼æ ¼å¼ï¼‰
    const formattedProjects: Project[] = projects.map(p => ({
      id: p.id,
      dateAndFileName: p.date_and_file_name,
      description: p.description,
      category: p.category as any,
      status: p.status as any,
      github: p.github,
      vercel: p.vercel,
      deployment: p.deployment,
      path: p.path,
      statusNote: p.status_note,
      publicNote: p.public_note,
      developerNote: p.developer_note,
      visibility: p.visibility as any,
      imagePreviews: p.image_previews as any,
      imagePreviewMode: p.image_preview_mode as any,
      customInfoSections: p.custom_info_sections as any,
      documentMeta: p.document_meta,
      featured: p.featured,
      hidden: p.hidden,
      sortOrder: p.sort_order,
      createdAt: new Date(p.created_at).getTime(),
      updatedAt: new Date(p.updated_at).getTime(),
    }));

    // 6. è½‰æ›å¯†ç¢¼è³‡æ–™æ ¼å¼
    const formattedPasswords: PasswordEntry[] = passwords.map(p => ({
      id: p.id,
      platform: p.platform,
      account: p.account,
      password: p.password,
      createdAt: new Date(p.created_at).getTime(),
      updatedAt: new Date(p.updated_at).getTime(),
    }));

    // 7. è¨ˆç®—å…ƒæ•¸æ“š
    const metadata = {
      lastUpdated: Date.now(),
      version: '2.0.0',
      totalProjects: formattedProjects.length,
      publicProjects: formattedProjects.filter(
        p => !p.hidden && p.visibility.description && p.status !== 'discarded'
      ).length,
    };

    return {
      projects: formattedProjects,
      passwords: formattedPasswords,
      settings,
      metadata,
    };
  } catch (error) {
    console.error('âŒ è®€å–è³‡æ–™å¤±æ•—:', error);
    throw new Error(`Supabase è®€å–å¤±æ•—: ${error.message}`);
  }
}

/**
 * è®€å–å…¬é–‹å°ˆæ¡ˆï¼ˆè¨ªå®¢æ¨¡å¼ï¼‰
 */
export async function getPublicProjects(): Promise<Project[]> {
  try {
    const { data: projects, error } = await supabase
      .from('projects')
      .select('*')
      .eq('hidden', false)
      .neq('status', 'discarded')
      .order('sort_order', { ascending: true });

    if (error) throw error;

    return projects.map(p => ({
      id: p.id,
      dateAndFileName: p.date_and_file_name,
      description: p.description,
      category: p.category as any,
      status: p.status as any,
      github: p.github,
      vercel: p.vercel,
      deployment: p.deployment,
      path: p.path,
      statusNote: p.status_note,
      publicNote: p.public_note,
      developerNote: '', // è¨ªå®¢ä¸å¯è¦‹
      visibility: p.visibility as any,
      imagePreviews: p.image_previews as any,
      imagePreviewMode: p.image_preview_mode as any,
      customInfoSections: p.custom_info_sections as any,
      documentMeta: p.document_meta,
      featured: p.featured,
      hidden: p.hidden,
      sortOrder: p.sort_order,
      createdAt: new Date(p.created_at).getTime(),
      updatedAt: new Date(p.updated_at).getTime(),
    }));
  } catch (error) {
    console.error('âŒ è®€å–å…¬é–‹å°ˆæ¡ˆå¤±æ•—:', error);
    throw error;
  }
}

// =====================================================
// å°ˆæ¡ˆæ“ä½œå‡½æ•¸
// =====================================================

/**
 * æ–°å¢å°ˆæ¡ˆ
 */
export async function createProject(project: Partial<Project>): Promise<Project> {
  try {
    const { data, error } = await supabaseAdmin
      .from('projects')
      .insert([{
        id: project.id,
        date_and_file_name: project.dateAndFileName,
        description: project.description,
        category: project.category,
        status: project.status,
        github: project.github,
        vercel: project.vercel,
        deployment: project.deployment,
        path: project.path,
        status_note: project.statusNote,
        public_note: project.publicNote,
        developer_note: project.developerNote,
        visibility: project.visibility,
        image_previews: project.imagePreviews || [],
        image_preview_mode: project.imagePreviewMode || 'grid',
        custom_info_sections: project.customInfoSections || [],
        document_meta: project.documentMeta,
        featured: project.featured || false,
        hidden: project.hidden || false,
        sort_order: project.sortOrder || 0,
      }])
      .select()
      .single();

    if (error) throw error;

    return convertDbProjectToProject(data);
  } catch (error) {
    console.error('âŒ æ–°å¢å°ˆæ¡ˆå¤±æ•—:', error);
    throw error;
  }
}

/**
 * æ›´æ–°å°ˆæ¡ˆ
 */
export async function updateProject(
  id: string,
  updates: Partial<Project>
): Promise<Project> {
  try {
    const updateData: any = {};
    
    // è½‰æ›æ¬„ä½åç¨±
    if (updates.dateAndFileName !== undefined) updateData.date_and_file_name = updates.dateAndFileName;
    if (updates.description !== undefined) updateData.description = updates.description;
    if (updates.category !== undefined) updateData.category = updates.category;
    if (updates.status !== undefined) updateData.status = updates.status;
    if (updates.github !== undefined) updateData.github = updates.github;
    if (updates.vercel !== undefined) updateData.vercel = updates.vercel;
    if (updates.deployment !== undefined) updateData.deployment = updates.deployment;
    if (updates.path !== undefined) updateData.path = updates.path;
    if (updates.statusNote !== undefined) updateData.status_note = updates.statusNote;
    if (updates.publicNote !== undefined) updateData.public_note = updates.publicNote;
    if (updates.developerNote !== undefined) updateData.developer_note = updates.developerNote;
    if (updates.visibility !== undefined) updateData.visibility = updates.visibility;
    if (updates.imagePreviews !== undefined) updateData.image_previews = updates.imagePreviews;
    if (updates.imagePreviewMode !== undefined) updateData.image_preview_mode = updates.imagePreviewMode;
    if (updates.customInfoSections !== undefined) updateData.custom_info_sections = updates.customInfoSections;
    if (updates.documentMeta !== undefined) updateData.document_meta = updates.documentMeta;
    if (updates.featured !== undefined) updateData.featured = updates.featured;
    if (updates.hidden !== undefined) updateData.hidden = updates.hidden;
    if (updates.sortOrder !== undefined) updateData.sort_order = updates.sortOrder;

    const { data, error } = await supabaseAdmin
      .from('projects')
      .update(updateData)
      .eq('id', id)
      .select()
      .single();

    if (error) throw error;

    return convertDbProjectToProject(data);
  } catch (error) {
    console.error('âŒ æ›´æ–°å°ˆæ¡ˆå¤±æ•—:', error);
    throw error;
  }
}

/**
 * åˆªé™¤å°ˆæ¡ˆ
 */
export async function deleteProject(id: string): Promise<void> {
  try {
    const { error } = await supabaseAdmin
      .from('projects')
      .delete()
      .eq('id', id);

    if (error) throw error;
  } catch (error) {
    console.error('âŒ åˆªé™¤å°ˆæ¡ˆå¤±æ•—:', error);
    throw error;
  }
}

/**
 * æ‰¹é‡æ›´æ–°å°ˆæ¡ˆæ’åº
 */
export async function reorderProjects(
  updates: Array<{ id: string; sortOrder: number }>
): Promise<void> {
  try {
    // Supabase ä¸æ”¯æ´æ‰¹é‡æ›´æ–°ï¼Œéœ€è¦é€ä¸€æ›´æ–°
    for (const update of updates) {
      const { error } = await supabaseAdmin
        .from('projects')
        .update({ sort_order: update.sortOrder })
        .eq('id', update.id);

      if (error) throw error;
    }
  } catch (error) {
    console.error('âŒ æ›´æ–°æ’åºå¤±æ•—:', error);
    throw error;
  }
}

// =====================================================
// UI è¨­å®šæ“ä½œ
// =====================================================

/**
 * è®€å– UI é¡¯ç¤ºè¨­å®š
 */
export async function getUIDisplaySettings(): Promise<UIDisplaySettings> {
  try {
    const { data, error } = await supabase
      .from('settings')
      .select('value')
      .eq('key', 'ui_display')
      .single();

    if (error) throw error;

    return data.value as UIDisplaySettings;
  } catch (error) {
    console.error('âŒ è®€å– UI è¨­å®šå¤±æ•—:', error);
    throw error;
  }
}

/**
 * æ›´æ–° UI é¡¯ç¤ºè¨­å®š
 */
export async function updateUIDisplaySettings(
  settings: UIDisplaySettings
): Promise<void> {
  try {
    const { error } = await supabaseAdmin
      .from('settings')
      .update({ value: settings })
      .eq('key', 'ui_display');

    if (error) throw error;
  } catch (error) {
    console.error('âŒ æ›´æ–° UI è¨­å®šå¤±æ•—:', error);
    throw error;
  }
}

// =====================================================
// è¼”åŠ©å‡½æ•¸
// =====================================================

/**
 * è½‰æ›è³‡æ–™åº«æ ¼å¼ â†’ ç¨‹å¼ç¢¼æ ¼å¼
 */
function convertDbProjectToProject(dbProject: any): Project {
  return {
    id: dbProject.id,
    dateAndFileName: dbProject.date_and_file_name,
    description: dbProject.description,
    category: dbProject.category,
    status: dbProject.status,
    github: dbProject.github,
    vercel: dbProject.vercel,
    deployment: dbProject.deployment,
    path: dbProject.path,
    statusNote: dbProject.status_note,
    publicNote: dbProject.public_note,
    developerNote: dbProject.developer_note,
    visibility: dbProject.visibility,
    imagePreviews: dbProject.image_previews || [],
    imagePreviewMode: dbProject.image_preview_mode,
    customInfoSections: dbProject.custom_info_sections || [],
    documentMeta: dbProject.document_meta,
    featured: dbProject.featured,
    hidden: dbProject.hidden,
    sortOrder: dbProject.sort_order,
    createdAt: new Date(dbProject.created_at).getTime(),
    updatedAt: new Date(dbProject.updated_at).getTime(),
  };
}

/**
 * é©—è­‰ç®¡ç†å“¡å¯†ç¢¼
 */
export function verifyAdminPassword(password: string): boolean {
  return password === process.env.ADMIN_PASSWORD;
}
```

---

## ğŸ”„ æ­¥é©Ÿ 3ï¼šä¿®æ”¹ API è·¯ç”±

### 3.1 ä¿®æ”¹å°ˆæ¡ˆåˆ—è¡¨ API

**æª”æ¡ˆ**ï¼š`app/api/projects/route.ts`

**ä¿®æ”¹ç­–ç•¥**ï¼š
- ç§»é™¤ `blob-storage.ts` çš„å¼•ç”¨
- æ”¹ç”¨ `supabase.ts` çš„å‡½æ•¸
- ä¿æŒå…¶ä»–é‚è¼¯ä¸è®Š

**å®Œæ•´å…§å®¹**ï¼š

```typescript
import { NextResponse } from 'next/server';
import { v4 as uuidv4 } from 'uuid';
import {
  readProjectData,
  getPublicProjects,
  createProject,
  verifyAdminPassword,
} from '@/lib/supabase';
import type { Project } from '@/types';

// GET /api/projects - ç²å–å°ˆæ¡ˆåˆ—è¡¨
export async function GET(request: Request) {
  try {
    const { searchParams } = new URL(request.url);
    const isAdmin = searchParams.get('admin') === 'true';
    const password = request.headers.get('x-admin-password');

    if (isAdmin) {
      // é©—è­‰ç®¡ç†å“¡å¯†ç¢¼
      if (!password || !verifyAdminPassword(password)) {
        return NextResponse.json(
          { error: 'æœªæˆæ¬Š' },
          { status: 401 }
        );
      }

      // è¿”å›æ‰€æœ‰å°ˆæ¡ˆ
      const data = await readProjectData();
      return NextResponse.json(data.projects);
    } else {
      // è¿”å›å…¬é–‹å°ˆæ¡ˆ
      const projects = await getPublicProjects();
      return NextResponse.json(projects);
    }
  } catch (error) {
    console.error('GET /api/projects éŒ¯èª¤:', error);
    return NextResponse.json(
      { error: 'è®€å–å¤±æ•—' },
      { status: 500 }
    );
  }
}

// POST /api/projects - æ–°å¢å°ˆæ¡ˆ
export async function POST(request: Request) {
  try {
    const password = request.headers.get('x-admin-password');

    // é©—è­‰ç®¡ç†å“¡å¯†ç¢¼
    if (!password || !verifyAdminPassword(password)) {
      return NextResponse.json(
        { error: 'æœªæˆæ¬Š' },
        { status: 401 }
      );
    }

    const projectData = await request.json();

    // ç”¢ç”Ÿæ–° ID
    const newProject: Partial<Project> = {
      ...projectData,
      id: uuidv4(),
      createdAt: Date.now(),
      updatedAt: Date.now(),
    };

    // æ–°å¢å°ˆæ¡ˆ
    const created = await createProject(newProject);

    return NextResponse.json(created, { status: 201 });
  } catch (error) {
    console.error('POST /api/projects éŒ¯èª¤:', error);
    return NextResponse.json(
      { error: 'æ–°å¢å¤±æ•—' },
      { status: 500 }
    );
  }
}
```

### 3.2 ä¿®æ”¹å–®ä¸€å°ˆæ¡ˆ API

**æª”æ¡ˆ**ï¼š`app/api/projects/[id]/route.ts`

```typescript
import { NextResponse } from 'next/server';
import {
  readProjectData,
  updateProject,
  deleteProject,
  verifyAdminPassword,
} from '@/lib/supabase';

// GET /api/projects/:id - ç²å–å–®ä¸€å°ˆæ¡ˆ
export async function GET(
  request: Request,
  { params }: { params: { id: string } }
) {
  try {
    const data = await readProjectData();
    const project = data.projects.find(p => p.id === params.id);

    if (!project) {
      return NextResponse.json(
        { error: 'å°ˆæ¡ˆä¸å­˜åœ¨' },
        { status: 404 }
      );
    }

    return NextResponse.json(project);
  } catch (error) {
    console.error('GET /api/projects/:id éŒ¯èª¤:', error);
    return NextResponse.json(
      { error: 'è®€å–å¤±æ•—' },
      { status: 500 }
    );
  }
}

// PATCH /api/projects/:id - æ›´æ–°å°ˆæ¡ˆ
export async function PATCH(
  request: Request,
  { params }: { params: { id: string } }
) {
  try {
    const password = request.headers.get('x-admin-password');

    if (!password || !verifyAdminPassword(password)) {
      return NextResponse.json(
        { error: 'æœªæˆæ¬Š' },
        { status: 401 }
      );
    }

    const updates = await request.json();
    const updated = await updateProject(params.id, updates);

    return NextResponse.json(updated);
  } catch (error) {
    console.error('PATCH /api/projects/:id éŒ¯èª¤:', error);
    return NextResponse.json(
      { error: 'æ›´æ–°å¤±æ•—' },
      { status: 500 }
    );
  }
}

// DELETE /api/projects/:id - åˆªé™¤å°ˆæ¡ˆ
export async function DELETE(
  request: Request,
  { params }: { params: { id: string } }
) {
  try {
    const password = request.headers.get('x-admin-password');

    if (!password || !verifyAdminPassword(password)) {
      return NextResponse.json(
        { error: 'æœªæˆæ¬Š' },
        { status: 401 }
      );
    }

    await deleteProject(params.id);

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error('DELETE /api/projects/:id éŒ¯èª¤:', error);
    return NextResponse.json(
      { error: 'åˆªé™¤å¤±æ•—' },
      { status: 500 }
    );
  }
}
```

### 3.3 ä¿®æ”¹å°ˆæ¡ˆæ’åº API

**æª”æ¡ˆ**ï¼š`app/api/projects/reorder/route.ts`

```typescript
import { NextResponse } from 'next/server';
import { reorderProjects, verifyAdminPassword } from '@/lib/supabase';

export async function POST(request: Request) {
  try {
    const password = request.headers.get('x-admin-password');

    if (!password || !verifyAdminPassword(password)) {
      return NextResponse.json(
        { error: 'æœªæˆæ¬Š' },
        { status: 401 }
      );
    }

    const updates = await request.json();
    await reorderProjects(updates);

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error('POST /api/projects/reorder éŒ¯èª¤:', error);
    return NextResponse.json(
      { error: 'æ›´æ–°æ’åºå¤±æ•—' },
      { status: 500 }
    );
  }
}
```

### 3.4 ä¿®æ”¹ UI è¨­å®š API

**æª”æ¡ˆ**ï¼š`app/api/settings/ui-display/route.ts`

```typescript
import { NextResponse } from 'next/server';
import {
  getUIDisplaySettings,
  updateUIDisplaySettings,
  verifyAdminPassword,
} from '@/lib/supabase';

// GET /api/settings/ui-display
export async function GET() {
  try {
    const settings = await getUIDisplaySettings();
    return NextResponse.json(settings);
  } catch (error) {
    console.error('GET /api/settings/ui-display éŒ¯èª¤:', error);
    return NextResponse.json(
      { error: 'è®€å–å¤±æ•—' },
      { status: 500 }
    );
  }
}

// PUT /api/settings/ui-display
export async function PUT(request: Request) {
  try {
    const password = request.headers.get('x-admin-password');

    if (!password || !verifyAdminPassword(password)) {
      return NextResponse.json(
        { error: 'æœªæˆæ¬Š' },
        { status: 401 }
      );
    }

    const settings = await request.json();
    await updateUIDisplaySettings(settings);

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error('PUT /api/settings/ui-display éŒ¯èª¤:', error);
    return NextResponse.json(
      { error: 'æ›´æ–°å¤±æ•—' },
      { status: 500 }
    );
  }
}
```

---

## ğŸ—‚ï¸ æ­¥é©Ÿ 4ï¼šç§»é™¤èˆŠçš„è³‡æ–™å­˜å–å±¤ï¼ˆé¸æ“‡æ€§ï¼‰

### 4.1 ä¿ç•™å‚™ä»½

```bash
# é‡æ–°å‘½åèˆŠæª”æ¡ˆä½œç‚ºå‚™ä»½
mv app/lib/blob-storage.ts app/lib/blob-storage.ts.backup
mv app/lib/data-safety.ts app/lib/data-safety.ts.backup
```

### 4.2 æˆ–æš«æ™‚ä¿ç•™

å¦‚æœæƒ³è¦é›™é‡ä¿éšªï¼Œå¯ä»¥æš«æ™‚ä¿ç•™èˆŠæª”æ¡ˆï¼Œç­‰ç¢ºèªæ–°ç³»çµ±ç©©å®šå¾Œå†åˆªé™¤ã€‚

---

## ğŸ”‘ æ­¥é©Ÿ 5ï¼šè¨­å®šæœ¬åœ°ç’°å¢ƒè®Šæ•¸

### 5.1 å»ºç«‹ .env.local

**åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„å»ºç«‹æˆ–ä¿®æ”¹** `.env.local`ï¼š

```bash
# Supabase è¨­å®š
NEXT_PUBLIC_SUPABASE_URL=https://[your-project-id].supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGci...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGci...

# ç®¡ç†å“¡å¯†ç¢¼ï¼ˆä¿æŒä¸è®Šï¼‰
ADMIN_PASSWORD=ä½ çš„ç®¡ç†å“¡å¯†ç¢¼
```

**é‡è¦æé†’**ï¼š
- âš ï¸ `.env.local` ä¸æ‡‰æäº¤åˆ° Git
- âš ï¸ Service Role Key å¿…é ˆä¿å¯†
- âœ… å¾ Supabase Settings â†’ API è¤‡è£½é‡‘é‘°

---

## ğŸ§ª æ­¥é©Ÿ 6ï¼šæœ¬åœ°æ¸¬è©¦

### 6.1 å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨

```bash
npm run dev

# æ‡‰è©²çœ‹åˆ°ï¼š
# â–² Next.js 14.x.x
# - Local:        http://localhost:3000
# - ready started server on 0.0.0.0:3000
```

### 6.2 æ¸¬è©¦è¨ªå®¢åŠŸèƒ½

**åœ¨ç€è¦½å™¨å‰å¾€**ï¼š`http://localhost:3000`

```
æ¸¬è©¦é …ç›®ï¼š
â–¡ é¦–é è¼‰å…¥æ­£å¸¸
â–¡ å¯çœ‹åˆ°å°ˆæ¡ˆåˆ—è¡¨
â–¡ å°ˆæ¡ˆæ•¸é‡æ­£ç¢º
â–¡ æœå°‹åŠŸèƒ½æ­£å¸¸
â–¡ ç¯©é¸åŠŸèƒ½æ­£å¸¸
â–¡ åœ–ç‰‡é¡¯ç¤ºæ­£å¸¸ï¼ˆæª¢æŸ¥æ˜¯å¦å¾ Supabase Storage è¼‰å…¥ï¼‰
â–¡ çµ±è¨ˆæ•¸æ“šæ­£ç¢º
```

**æª¢æŸ¥åœ–ç‰‡ URL**ï¼š
- å³éµæª¢æŸ¥åœ–ç‰‡
- URL æ‡‰è©²æ˜¯ `https://xxx.supabase.co/storage/v1/object/public/screenshots/...`

### 6.3 æ¸¬è©¦ç®¡ç†å“¡åŠŸèƒ½

**å‰å¾€ç®¡ç†å¾Œå°**ï¼š`http://localhost:3000/admin`

```
æ¸¬è©¦é …ç›®ï¼š
â–¡ å¯æ­£å¸¸ç™»å…¥
â–¡ å¾Œå°è¼‰å…¥æ­£å¸¸
â–¡ å¯çœ‹åˆ°æ‰€æœ‰å°ˆæ¡ˆï¼ˆåŒ…æ‹¬éš±è—çš„ï¼‰
â–¡ æ–°å¢å°ˆæ¡ˆæˆåŠŸ
â–¡ ç·¨è¼¯å°ˆæ¡ˆæˆåŠŸ
â–¡ åˆªé™¤å°ˆæ¡ˆæˆåŠŸ
â–¡ æ’åºåŠŸèƒ½æ­£å¸¸
â–¡ å„²å­˜å¾Œç«‹å³çœ‹åˆ°è®Šæ›´ï¼ˆ< 1 ç§’ï¼‰â­ é‡é»æ¸¬è©¦
```

### 6.4 æª¢æŸ¥é–‹ç™¼è€…å·¥å…·

**æŒ‰ F12 é–‹å•Ÿé–‹ç™¼è€…å·¥å…·**ï¼š

```
Console æ¨™ç±¤ï¼š
â–¡ ç„¡ç´…è‰²éŒ¯èª¤è¨Šæ¯
â–¡ å¯èƒ½æœ‰ä¸€äº› Info æˆ– Warningï¼ˆæ­£å¸¸ï¼‰

Network æ¨™ç±¤ï¼š
â–¡ API è«‹æ±‚éƒ½è¿”å› 200 æˆ– 201
â–¡ æ²’æœ‰ 401 æˆ– 500 éŒ¯èª¤
â–¡ å›æ‡‰æ™‚é–“ < 500msï¼ˆSupabase é€Ÿåº¦ï¼‰
```

### 6.5 æ•ˆèƒ½æ¸¬è©¦

**é‡é»æ¸¬è©¦å³æ™‚æ€§**ï¼š

```
1. åœ¨å¾Œå°æ–°å¢ä¸€å€‹æ¸¬è©¦å°ˆæ¡ˆ
2. é»æ“Šå„²å­˜
3. è¨ˆæ™‚çœ‹å¤šä¹…å¯ä»¥çœ‹åˆ°è®Šæ›´

é æœŸçµæœï¼š
âœ… < 1 ç§’å³å¯çœ‹åˆ°è®Šæ›´ï¼ˆå¤§å¹…æ”¹å–„ï¼ï¼‰
âœ… ç„¡éœ€é‡æ–°æ•´ç†é é¢
âœ… è³‡æ–™ç«‹å³åŒæ­¥
```

---

## âœ… å®Œæˆæª¢æ ¸

### ç¨‹å¼ç¢¼ä¿®æ”¹
- [ ] âœ… å·²å®‰è£ @supabase/supabase-js
- [ ] âœ… å·²å»ºç«‹ app/lib/supabase.ts
- [ ] âœ… å·²ä¿®æ”¹ app/api/projects/route.ts
- [ ] âœ… å·²ä¿®æ”¹ app/api/projects/[id]/route.ts
- [ ] âœ… å·²ä¿®æ”¹ app/api/projects/reorder/route.ts
- [ ] âœ… å·²ä¿®æ”¹ app/api/settings/ui-display/route.ts
- [ ] âœ… å·²è¨­å®š .env.local

### æœ¬åœ°æ¸¬è©¦
- [ ] âœ… é–‹ç™¼ä¼ºæœå™¨æ­£å¸¸å•Ÿå‹•
- [ ] âœ… è¨ªå®¢åŠŸèƒ½å…¨éƒ¨æ­£å¸¸
- [ ] âœ… ç®¡ç†å“¡åŠŸèƒ½å…¨éƒ¨æ­£å¸¸
- [ ] âœ… å³æ™‚æ›´æ–°æ­£å¸¸ï¼ˆ< 1 ç§’ï¼‰
- [ ] âœ… ç„¡ Console éŒ¯èª¤
- [ ] âœ… API å›æ‡‰æ™‚é–“æ­£å¸¸

### è³‡æ–™é©—è­‰
- [ ] âœ… å°ˆæ¡ˆåˆ—è¡¨è³‡æ–™æ­£ç¢º
- [ ] âœ… åœ–ç‰‡å¾ Supabase è¼‰å…¥
- [ ] âœ… æ–°å¢/ç·¨è¼¯/åˆªé™¤éƒ½æ­£å¸¸
- [ ] âœ… æ’åºåŠŸèƒ½æ­£å¸¸

---

## ğŸ¯ ä¸‹ä¸€æ­¥

æ­å–œå®Œæˆç¨‹å¼ç¢¼æ”¹é€ ï¼æ‚¨ç¾åœ¨å·²ç¶“ï¼š
- âœ… æˆåŠŸå°‡ç¨‹å¼ç¢¼é€£æ¥åˆ° Supabase
- âœ… åœ¨æœ¬åœ°æ¸¬è©¦æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
- âœ… é©—è­‰äº†å³æ™‚æ›´æ–°èƒ½åŠ›

**ç¨‹å¼ç¢¼å·²ç¶“æº–å‚™å¥½éƒ¨ç½²åˆ°ç·šä¸Šäº†ï¼**

ğŸ‘‰ è«‹è¿”å›é–±è®€ï¼š`00_é·ç§»ç¸½è¦½èˆ‡æµç¨‹æ¸…å–®.md` çš„éšæ®µ 4

---

## ğŸ†˜ é‡åˆ°å•é¡Œï¼Ÿ

### å¸¸è¦‹å•é¡Œ

**Q: ç’°å¢ƒè®Šæ•¸è®€å–ä¸åˆ°ï¼Ÿ**  
A: ä¿®æ”¹ .env.local å¾Œéœ€è¦é‡å•Ÿé–‹ç™¼ä¼ºæœå™¨ï¼ˆCtrl+C ç„¶å¾Œ npm run devï¼‰

**Q: åœ–ç‰‡ç„¡æ³•é¡¯ç¤ºï¼Ÿ**  
A: æª¢æŸ¥ Storage bucket çš„ Public æ¬Šé™å’Œ CORS è¨­å®š

**Q: API è¿”å› 401 éŒ¯èª¤ï¼Ÿ**  
A: æª¢æŸ¥ SUPABASE_SERVICE_ROLE_KEY æ˜¯å¦æ­£ç¢ºè¨­å®š

**Q: TypeScript é¡å‹éŒ¯èª¤ï¼Ÿ**  
A: ç¢ºèª @/types ä¸­çš„é¡å‹å®šç¾©èˆ‡è³‡æ–™åº«çµæ§‹ä¸€è‡´

**Q: è³‡æ–™æ ¼å¼ä¸ç¬¦ï¼Ÿ**  
A: æª¢æŸ¥ convertDbProjectToProject å‡½æ•¸çš„æ¬„ä½æ˜ å°„


