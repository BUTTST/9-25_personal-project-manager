<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>首頁布局方案預覽</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        
        .layout-preview {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .stat-item {
            transition: all 0.2s;
        }
        
        .stat-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .filter-btn {
            transition: all 0.2s;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            background: white;
            display: inline-flex;
            align-items: center;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .filter-btn:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        
        .filter-btn.active {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        [draggable="true"] {
            cursor: move;
        }
        
        [draggable="true"]:active {
            cursor: grabbing;
        }
    </style>
</head>
<body>
    <!-- 方案 6: 最終版本（搜尋框+篩選器+統計區塊+設定按鈕） -->
    <div class="layout-preview">
        <h2 class="text-2xl font-bold mb-4 text-gray-800">方案 6: 最終版本（可拖移排序）</h2>
        <p class="text-gray-600 mb-6">搜尋框固定高度 + 篩選按鈕 + 統計區塊（2-8個，2列橫向擴展）+ 齒輪設定按鈕</p>
        
        <!-- 主要內容區域 -->
        <div class="flex gap-4 items-start">
            <!-- 左側：搜尋與篩選 -->
            <div class="flex-1 space-y-4">
                <!-- 搜尋框（固定高度） -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-xl border border-blue-200 shadow-sm">
                    <div class="flex items-center gap-2">
                        <svg class="h-5 w-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <input type="text" placeholder="搜尋專案..." class="flex-1 bg-transparent border-none outline-none text-gray-700">
                    </div>
                </div>
                
                <!-- 篩選按鈕區域 -->
                <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-xl border border-purple-200 shadow-sm">
                    <div class="flex flex-wrap gap-2 items-center" id="filterButtonsContainer6">
                        <!-- 篩選按鈕將由 JS 動態渲染 -->
                    </div>
                </div>
            </div>
            
            <!-- 右側：統計區塊 + 設定按鈕 -->
            <div class="space-y-2">
                <div id="statsContainer6" class="grid grid-rows-2 gap-0 bg-gradient-to-r from-blue-600/20 to-purple-600/20 backdrop-blur-sm border border-blue-500/30 rounded-xl shadow-lg overflow-hidden" style="grid-auto-flow: column; grid-auto-columns: minmax(90px, 1fr);">
                    <!-- 統計方塊將由 JS 動態渲染 -->
                </div>
                
                <!-- 設定按鈕 -->
                <button onclick="toggleSettings6()" class="w-full px-3 py-2 bg-gradient-to-r from-yellow-500 to-orange-500 text-white rounded-lg text-sm font-medium hover:from-yellow-600 hover:to-orange-600 transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    設定
                </button>
            </div>
        </div>
    </div>
    
    <!-- 設定面板（方案 6） -->
    <div id="settingsPanel6" class="fixed left-1/2 z-50 bg-slate-900/95 backdrop-blur-xl border-2 border-blue-500/50 rounded-2xl shadow-2xl overflow-hidden hidden" style="width: 80%; height: 45vh; top: 50%; transform: translate(-50%, -50%);">
        <!-- 面板頭部 -->
        <div class="flex items-center justify-between bg-gradient-to-r from-blue-600/20 to-purple-600/20 border-b border-blue-500/30 px-4 py-2">
            <h3 class="text-sm font-bold text-white flex items-center gap-2">
                <svg class="h-4 w-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                顯示設定
            </h3>
            <div class="flex items-center gap-2">
                <!-- 尺寸設定按鈕 -->
                <button onclick="toggleSizeSettings()" class="text-gray-400 hover:text-yellow-400 transition-colors p-1 hover:bg-white/10 rounded" title="尺寸設定">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path>
                    </svg>
                </button>
                <!-- 關閉按鈕 -->
                <button onclick="toggleSettings6()" class="text-gray-400 hover:text-white transition-colors p-1 hover:bg-white/10 rounded">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- 尺寸設定面板 -->
        <div id="sizeSettings" class="bg-slate-800/90 border-b border-yellow-500/30 p-3 hidden">
            <div class="grid grid-cols-3 gap-3 text-xs">
                <div class="space-y-1">
                    <label class="text-gray-300 flex justify-between">
                        <span>寬度</span>
                        <span class="text-blue-400 font-mono" id="widthValue">80%</span>
                    </label>
                    <input type="range" id="widthSlider" min="50" max="95" value="80" step="5" class="w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer" oninput="updatePanelSize()">
                </div>
                
                <div class="space-y-1">
                    <label class="text-gray-300 flex justify-between">
                        <span>高度</span>
                        <span class="text-green-400 font-mono" id="heightValue">45vh</span>
                    </label>
                    <input type="range" id="heightSlider" min="30" max="90" value="45" step="5" class="w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer" oninput="updatePanelSize()">
                </div>
                
                <div class="space-y-1">
                    <label class="text-gray-300 flex justify-between">
                        <span>頂部距離</span>
                        <span class="text-purple-400 font-mono" id="topValue">50%</span>
                    </label>
                    <input type="range" id="topSlider" min="5" max="50" value="50" step="5" class="w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer" oninput="updatePanelSize()">
                </div>
            </div>
            <div class="mt-2 flex items-center justify-between">
                <button onclick="resetPanelSize()" class="text-xs px-2 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors">
                    重置預設
                </button>
                <div class="text-xs text-gray-400">
                    <span class="text-white font-mono">
                        W:<span id="displayWidth">80</span>% H:<span id="displayHeight">45</span>vh T:<span id="displayTop">50</span>%
                    </span>
                </div>
            </div>
        </div>
        
        <!-- 面板內容 -->
        <div class="grid grid-cols-2 gap-6 p-6 overflow-y-auto" style="max-height: calc(45vh - 100px);">
            <!-- 左區：分類篩選設定 -->
            <div class="space-y-4">
                <h4 class="text-white font-bold flex items-center gap-2">
                    <svg class="h-5 w-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                    </svg>
                    分類篩選器
                </h4>
                
                <div id="filtersList" class="space-y-2 bg-slate-800/50 rounded-lg p-3 max-h-64 overflow-y-auto">
                    <!-- 篩選項目將由 JS 生成 -->
                </div>
            </div>
            
            <!-- 右區：統計資訊設定 -->
            <div class="space-y-4">
                <div class="flex items-center gap-2">
                    <h4 class="text-white font-bold flex items-center gap-2">
                        <svg class="h-5 w-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        統計資訊
                    </h4>
                    <div class="text-xs text-yellow-400">
                        最多8個
                    </div>
                </div>
                
                <div id="statsList" class="space-y-2 bg-slate-800/50 rounded-lg p-3 max-h-64 overflow-y-auto">
                    <!-- 統計項目將由 JS 生成 -->
                </div>
            </div>
        </div>
        
        <!-- 底部按鈕 -->
        <div class="border-t border-blue-500/30 p-4 bg-slate-800/50 flex justify-end gap-3">
            <button onclick="toggleSettings6()" class="px-4 py-2 text-sm font-medium text-gray-300 hover:text-white bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors">
                取消
            </button>
            <button onclick="alert('設定已儲存！（預覽模式）')" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">
                儲存設定
            </button>
        </div>
    </div>
    
    <!-- 方案 5: 極簡浮動布局（保留參考） -->
    <div class="layout-preview">
        <h2 class="text-2xl font-bold mb-4 text-gray-800">方案 5: 極簡浮動布局（參考）</h2>
        <p class="text-gray-600 mb-6">簡化版本，僅顯示核心資訊</p>
        
        <div class="flex gap-4 items-start">
            <!-- 左側：搜尋與篩選 -->
            <div class="flex-1 space-y-4">
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-xl border border-blue-200 shadow-sm">
                    <div class="flex items-center gap-2">
                        <svg class="h-5 w-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <input type="text" placeholder="搜尋專案..." class="flex-1 bg-transparent border-none outline-none text-gray-700">
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-xl border border-purple-200 shadow-sm">
                    <div class="flex flex-wrap gap-2">
                        <button class="filter-btn active">
                            <svg class="inline h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                            全部
                        </button>
                        <button class="filter-btn">
                            <svg class="inline h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3l14 9-14 9V3z"></path></svg>
                            重要
                        </button>
                        <button class="filter-btn">
                            <svg class="inline h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            完成
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 右側：統計方塊 -->
            <div class="grid grid-rows-2 gap-0 bg-gradient-to-r from-blue-600/20 to-purple-600/20 backdrop-blur-sm border border-blue-500/30 rounded-xl shadow-lg overflow-hidden" style="grid-auto-flow: column; grid-auto-columns: minmax(90px, 1fr);">
                <div class="stat-item px-4 py-2 text-center flex flex-col justify-center border-r border-b border-blue-500/20">
                    <div class="text-lg font-bold text-white">12</div>
                    <div class="text-xs text-gray-300">專案</div>
                </div>
                <div class="stat-item px-4 py-2 text-center flex flex-col justify-center">
                    <div class="text-lg font-bold text-white">8</div>
                    <div class="text-xs text-gray-300">顯示</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ===== 全局變數 =====
        const filterIconMap = {
            all: `<svg class="inline h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>`,
            important: `<svg class="inline h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3l14 9-14 9V3z"></path></svg>`,
            secondary: `<svg class="inline h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"></path></svg>`,
            practice: `<svg class="inline h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>`,
            completed: `<svg class="inline h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`,
            abandoned: `<svg class="inline h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path></svg>`,
        };
        
        const filterLabels = {
            all: '全部',
            important: '重要',
            secondary: '次要',
            practice: '實踐',
            completed: '完成',
            abandoned: '捨棄'
        };
        
        const statLabels = {
            'stat-total': '總專案數',
            'stat-display': '顯示中',
            'stat-public': '公開專案',
            'stat-important': '重要專案',
            'stat-completed': '已完成',
            'stat-inprogress': '進行中',
            'stat-ready': '準備就緒',
            'stat-abandoned': '已捨棄'
        };
        
        const statValues = {
            'stat-total': '12',
            'stat-display': '8',
            'stat-public': '10',
            'stat-important': '3',
            'stat-completed': '5',
            'stat-inprogress': '6',
            'stat-ready': '✓',
            'stat-abandoned': '2'
        };
        
        // ===== 初始化數據 =====
        const initialFilters = [
            { id: 'all', checked: true },
            { id: 'important', checked: true },
            { id: 'secondary', checked: true },
            { id: 'practice', checked: true },
            { id: 'completed', checked: true },
            { id: 'abandoned', checked: true }
        ];
        
        const initialStats = [
            { id: 'stat-total', checked: true },
            { id: 'stat-display', checked: true },
            { id: 'stat-public', checked: false },
            { id: 'stat-important', checked: false },
            { id: 'stat-completed', checked: false },
            { id: 'stat-inprogress', checked: false },
            { id: 'stat-ready', checked: false },
            { id: 'stat-abandoned', checked: false }
        ];
        
        // ===== UI 更新函數 =====
        function updateLiveUI() {
            // 更新統計區塊
            const orderedCheckedStats = Array.from(document.querySelectorAll('#statsList div[draggable="true"]'))
                .map(item => item.querySelector('.stat-checkbox6'))
                .filter(cb => cb && cb.checked);
            updateStats6(orderedCheckedStats);

            // 更新篩選按鈕
            updateFilterButtons();
        }
        
        function updateFilterButtons() {
            const filterItems = document.querySelectorAll('#filtersList div[draggable="true"]');
            const container = document.getElementById('filterButtonsContainer6');
            if (!container) return;
            container.innerHTML = '';

            filterItems.forEach(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                if (checkbox.checked) {
                    const labelText = item.querySelector('span').textContent;
                    const filterKey = checkbox.dataset.filter;
                    
                    const button = document.createElement('button');
                    button.className = 'filter-btn';
                    if (filterKey === 'all') {
                        button.classList.add('active');
                    }
                    const iconHTML = filterIconMap[filterKey] || '';
                    button.innerHTML = `${iconHTML} ${labelText}`;
                    container.appendChild(button);
                }
            });
        }

        function updateStats6(checkboxes) {
            const container = document.getElementById('statsContainer6');
            const count = checkboxes.length;
            container.innerHTML = '';
            
            container.className = 'grid grid-rows-2 gap-0 bg-gradient-to-r from-blue-600/20 to-purple-600/20 backdrop-blur-sm border border-blue-500/30 rounded-xl shadow-lg overflow-hidden';
            container.style.gridAutoFlow = 'column';
            container.style.gridAutoColumns = 'minmax(90px, 1fr)';
            
            let index = 0;
            checkboxes.forEach((checkbox) => {
                const label = checkbox.dataset.label;
                const value = checkbox.dataset.value;
                
                const col = Math.floor(index / 2);
                const isLastCol = (col === Math.ceil(count / 2) - 1);
                const needsRightBorder = !isLastCol;
                
                const isFirstRow = (index % 2 === 0);
                const hasPair = (index + 1 < count);
                const needsBottomBorder = isFirstRow && hasPair;
                
                const div = document.createElement('div');
                div.className = `stat-item px-4 py-2 text-center flex flex-col justify-center ${needsRightBorder ? 'border-r border-blue-500/20' : ''} ${needsBottomBorder ? 'border-b border-blue-500/20' : ''}`;
                div.innerHTML = `
                    <div class="text-lg font-bold text-white">${value}</div>
                    <div class="text-xs text-gray-300">${label}</div>
                `;
                container.appendChild(div);
                index++;
            });
        }
        
        // ===== 拖移排序 =====
        let draggedElement = null;
        
        function initDragAndDrop() {
            const statsList = document.getElementById('statsList');
            const filtersList = document.getElementById('filtersList');
            
            setupDragForContainer(statsList);
            setupDragForContainer(filtersList);
        }
        
        function setupDragForContainer(container) {
            container.addEventListener('dragstart', (e) => {
                const target = e.target.closest('[draggable="true"]');
                if (target) {
                    draggedElement = target;
                    setTimeout(() => {
                        target.style.opacity = '0.4';
                    }, 0);
                }
            });
            
            container.addEventListener('dragend', (e) => {
                if (draggedElement) {
                    draggedElement.style.opacity = '1';
                    draggedElement = null;
                    setTimeout(updateLiveUI, 50);
                }
            });
            
            container.addEventListener('dragover', (e) => {
                e.preventDefault();
                const target = e.target.closest('[draggable="true"]');
                if (target && draggedElement && target !== draggedElement) {
                    const afterElement = getDragAfterElement(container, e.clientY);
                    if (afterElement == null) {
                        container.appendChild(draggedElement);
                    } else {
                        container.insertBefore(draggedElement, afterElement);
                    }
                }
            });
        }
        
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('[draggable="true"]:not([style*="opacity: 0.4"])')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
        
        // ===== 設定面板控制 =====
        function toggleSettings6() {
            const panel = document.getElementById('settingsPanel6');
            panel.classList.toggle('hidden');
        }
        
        function toggleSizeSettings() {
            const sizePanel = document.getElementById('sizeSettings');
            sizePanel.classList.toggle('hidden');
        }
        
        function updatePanelSize() {
            const panel = document.getElementById('settingsPanel6');
            const width = document.getElementById('widthSlider').value;
            const height = document.getElementById('heightSlider').value;
            const top = document.getElementById('topSlider').value;
            
            panel.style.width = `${width}%`;
            panel.style.height = `${height}vh`;
            panel.style.top = `${top}%`;
            
            document.getElementById('widthValue').textContent = `${width}%`;
            document.getElementById('heightValue').textContent = `${height}vh`;
            document.getElementById('topValue').textContent = `${top}%`;
            document.getElementById('displayWidth').textContent = width;
            document.getElementById('displayHeight').textContent = height;
            document.getElementById('displayTop').textContent = top;
        }
        
        function resetPanelSize() {
            document.getElementById('widthSlider').value = 80;
            document.getElementById('heightSlider').value = 45;
            document.getElementById('topSlider').value = 50;
            updatePanelSize();
        }
        
        // ===== 初始化 =====
        function initializeSettings() {
            const filtersList = document.getElementById('filtersList');
            const statsList = document.getElementById('statsList');
            
            // 初始化篩選器列表
            initialFilters.forEach((filter, index) => {
                const div = document.createElement('div');
                div.draggable = true;
                div.dataset.index = index;
                div.className = 'flex items-center justify-between p-2 hover:bg-slate-700/50 rounded group cursor-move';
                div.innerHTML = `
                    <label class="flex items-center gap-2 text-white cursor-pointer flex-1">
                        <svg class="h-4 w-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                        <input type="checkbox" ${filter.checked ? 'checked' : ''} class="w-4 h-4 rounded" data-filter="${filter.id}" onchange="updateLiveUI()">
                        <span>${filterLabels[filter.id]}</span>
                    </label>
                `;
                filtersList.appendChild(div);
            });
            
            // 初始化統計列表
            initialStats.forEach((stat, index) => {
                const div = document.createElement('div');
                div.draggable = true;
                div.dataset.index = index;
                div.className = 'flex items-center justify-between p-2 hover:bg-slate-700/50 rounded group cursor-move';
                div.innerHTML = `
                    <label class="flex items-center gap-2 text-white cursor-pointer flex-1">
                        <svg class="h-4 w-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                        <input type="checkbox" ${stat.checked ? 'checked' : ''} class="w-4 h-4 rounded stat-checkbox6" data-label="${statLabels[stat.id]}" data-value="${statValues[stat.id]}" onchange="handleStatChange(this)">
                        <span>${statLabels[stat.id]}</span>
                    </label>
                `;
                statsList.appendChild(div);
            });
        }
        
        function handleStatChange(checkbox) {
            const statCheckboxes = document.querySelectorAll('.stat-checkbox6:checked');
            if (checkbox.checked && statCheckboxes.length > 8) {
                alert('最多只能選擇8個統計項目！');
                checkbox.checked = false;
                return;
            }
            if (!checkbox.checked && statCheckboxes.length < 2) {
                alert('至少需要選擇2個統計項目！');
                checkbox.checked = true;
                return;
            }
            updateLiveUI();
        }
        
        // ===== 頁面加載完成後執行 =====
        window.addEventListener('DOMContentLoaded', () => {
            initializeSettings();
            initDragAndDrop();
            updateLiveUI();
        });
    </script>
</body>
</html>

