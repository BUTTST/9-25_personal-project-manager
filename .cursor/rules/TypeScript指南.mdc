---
globs: *.ts,*.tsx
---

# TypeScript 指南

## 型別定義

所有型別定義在 [app/types/index.ts](mdc:app/types/index.ts) 中。

### 核心型別

- **`Project`** - 專案完整資料結構
- **`ProjectCategory`** - 專案類別：`'important' | 'secondary' | 'practice' | 'single-doc' | 'completed' | 'abandoned'`
- **`ProjectStatus`** - 專案狀態：`'in-progress' | 'on-hold' | 'long-term' | 'completed' | 'discarded'`
- **`ProjectVisibility`** - 可見性控制物件
- **`ImagePreview`** - 圖片預覽資料
- **`UIDisplaySettings`** - UI 顯示設定
- **`AppSettings`** - 應用設定

### 型別轉換

資料庫使用 `snake_case`，前端使用 `camelCase`：
- `date_and_file_name` ↔ `dateAndFileName`
- `image_previews` ↔ `imagePreviews`
- `created_at` ↔ `createdAt`

### 型別輔助函式

- `ensureProjectVisibility()` - 確保可見性物件完整
- `normalizeProjectStatus()` - 正規化專案狀態
- `normalizeProjectCategory()` - 正規化專案類別
- `migrateLegacyCategoryToStatus()` - 遷移舊類別到新狀態

## TypeScript 配置

根據 [tsconfig.json](mdc:tsconfig.json)：
- `strict: false` - 非嚴格模式（允許漸進式遷移）
- `baseUrl: "."` - 基礎路徑
- 路徑別名已配置

## 最佳實踐

1. **使用型別匯入**：`import type { Project } from '@/types'`
2. **避免 `any`**：使用具體型別或 `unknown`
3. **型別守衛**：使用 `instanceof` 或自訂守衛函式
4. **可選鏈**：使用 `?.` 和 `??` 處理可選值
5. **型別斷言**：只在必要時使用 `as`，優先使用型別守衛

## API 回應型別

API 路由應返回標準格式：
```typescript
NextResponse.json({
  success: boolean;
  data?: T;
  error?: string;
  details?: string;
})
```
