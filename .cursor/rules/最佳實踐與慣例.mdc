---
alwaysApply: true
---

# 最佳實踐與慣例

## 程式碼風格

### 命名慣例

- **檔案名**：kebab-case（`project-card.tsx`）或 PascalCase（`ProjectCard.tsx`）
- **變數/函式**：camelCase（`getProjectList`）
- **常數**：UPPER_SNAKE_CASE（`ADMIN_PASSWORD`）
- **型別/介面**：PascalCase（`ProjectCardProps`）
- **元件**：PascalCase（`ProjectCard`）

### 註解規範

```typescript
/**
 * 函式說明
 * @param param 參數說明
 * @returns 回傳值說明
 */
export function functionName(param: Type): ReturnType {
  // 實作
}
```

### 匯入順序

1. React 相關
2. 第三方套件
3. 內部模組（`@/` 別名）
4. 型別匯入（`import type`）
5. 相對路徑匯入

```typescript
import { useState, useEffect } from 'react';
import { NextRequest, NextResponse } from 'next/server';
import clsx from 'clsx';

import { Project } from '@/types';
import { supabase } from '@/lib/supabase';

import type { ProjectCardProps } from './types';
```

## 錯誤處理

### API 錯誤回應

標準格式：
```typescript
return NextResponse.json(
  { 
    error: '使用者友善的錯誤訊息',
    details: error instanceof Error ? error.message : 'Unknown error'
  },
  { status: 500 }
);
```

### 前端錯誤處理

```typescript
try {
  const response = await fetch('/api/endpoint');
  if (!response.ok) {
    throw new Error('操作失敗');
  }
  const data = await response.json();
} catch (error) {
  console.error('Error:', error);
  // 顯示錯誤訊息給使用者
}
```

## 非同步操作

### API 路由

```typescript
export async function GET(request: NextRequest) {
  try {
    // 非同步操作
    const data = await someAsyncOperation();
    return NextResponse.json({ data });
  } catch (error) {
    console.error('Error:', error);
    return NextResponse.json(
      { error: '操作失敗' },
      { status: 500 }
    );
  }
}
```

### 前端元件

```typescript
const handleSubmit = async () => {
  setIsLoading(true);
  try {
    const response = await fetch('/api/endpoint');
    if (!response.ok) throw new Error('失敗');
    const data = await response.json();
    // 處理成功
  } catch (error) {
    console.error('Error:', error);
    // 顯示錯誤
  } finally {
    setIsLoading(false);
  }
};
```

## 狀態管理

### 本地狀態

優先使用 `useState`：
```typescript
const [state, setState] = useState<Type>(initialValue);
```

### 衍生狀態

使用 `useMemo`：
```typescript
const filteredItems = useMemo(() => {
  return items.filter(item => item.visible);
}, [items]);
```

### 回調函式

使用 `useCallback`：
```typescript
const handleClick = useCallback(() => {
  // 處理邏輯
}, [dependencies]);
```

## 效能優化

### 圖片優化

- 使用 Next.js `Image` 元件
- 提供適當的 `width` 和 `height`
- 使用 `loading="lazy"` 延遲載入

### 列表渲染

- 大型列表使用分頁或虛擬滾動
- 使用 `key` prop 優化重新渲染

### 快取策略

API 路由：
```typescript
export const revalidate = 0;
export const dynamic = 'force-dynamic';
```

## 可訪問性

### 語義化 HTML

```typescript
<nav aria-label="主要導航">
  <button aria-label="開啟選單">...</button>
</nav>
```

### 鍵盤導航

```typescript
<button
  onClick={handleClick}
  onKeyDown={(e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      handleClick();
    }
  }}
>
```

### ARIA 屬性

```typescript
<div
  role="dialog"
  aria-labelledby="dialog-title"
  aria-describedby="dialog-description"
>
```

## 測試

### 單元測試

```typescript
describe('functionName', () => {
  it('should handle normal case', () => {
    expect(functionName(input)).toBe(expected);
  });
});
```

### 整合測試

測試 API 端點和元件整合。

## Git 慣例

### Commit 訊息

- `feat:` - 新功能
- `fix:` - 修復錯誤
- `docs:` - 文件更新
- `style:` - 程式碼風格
- `refactor:` - 重構
- `test:` - 測試
- `chore:` - 雜務

### 分支命名

- `feature/功能名稱`
- `fix/錯誤描述`
- `refactor/重構內容`

## 文件

### README

保持 [README.md](mdc:README.md) 更新，包含：
- 專案說明
- 安裝步驟
- 使用指南
- API 文件

### 程式碼註解

複雜邏輯應添加註解說明：
```typescript
// ⭐ 關鍵改進：直接從資料庫讀取顯示名稱
// 這樣可以支援中文檔名顯示
const { data } = await supabaseAdmin.from('image_metadata').select('*');
```

## 環境變數

### 開發環境

使用 `.env.local`：
```
ADMIN_PASSWORD=dev_password
NEXT_PUBLIC_SUPABASE_URL=https://...
```

### 生產環境

在 Vercel 設定環境變數，不提交到 Git。

## 安全性

1. **環境變數**：敏感資訊僅在伺服器端使用
2. **輸入驗證**：所有輸入都應驗證
3. **錯誤訊息**：不洩露敏感資訊
4. **HTTPS**：生產環境強制使用 HTTPS
